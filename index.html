<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chart & Table</title>
                      <!--  Chartjs CDN  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
                      <!--  Tabulator CDN  -->
    <link href="https://unpkg.com/tabulator-tables@4.2.7/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.2.7/dist/js/tabulator.min.js"></script>
                      <!--  Bootstrap CDN  -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
                      <!--  JQuery CDN  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                      <!--  Styling -->
    <style>
        .chart{
            width: 60%;
            margin: 0 auto;
        }
        .chart-wrapper{
            margin-bottom: 50px;
        }
        .messageBox{
            display: none;
            width: 70%;
            margin: 20px auto;
            border: 1px solid black;
            border-radius: 15px;
            padding: 25px;
        }
    </style>
</head>
<body>
<div class="chart">
    <div class="chart-wrapper">
        <canvas id="myChart"></canvas>
    </div>
    <div id="chartTable"></div>
    <div class="panel panel-primary messageBox">
        <div class="panel-heading text-center"><h3>There are no records.</h3></div>
        <div class="panel-body text-center">
            <button type="button" class="btn btn-dark btn-lg">Check Logs</button>
        </div>
    </div>
</div>
</body>
<script>
    $(document).ready(function () {
        setInterval(()=> {ajaxCall()}, 10000)
    })

      function creatngChart(xValues, yValues){
        new Chart("myChart", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                    label: 'ROI',
                    fill: false,
                    lineTension: 0,
                    backgroundColor: "black",
                    borderColor: "black",
                    data: yValues
                }]
            },
            options: {
                title: {display: true, text: 'ROI vs Captured Date Chart'},
                legend: {display: true},
                scales: {
                    yAxes: [{ ticks: { min: 0, max: 100 }
                    }],
                }
            }
        });
      }
     function ajaxCall() {
        var xValues = [], yValues = [], idArray = [], url = "http://51.143.8.209:8000/Recorded/Data/6";
        var settings = {
            "url": url,
            "method": "GET",
            "timeout": 0,
            "headers": {
                "Authorization": "Token a07f52f72f904f81da711ce5072a14aa99eadb83"
            },
        };

        $.ajax(settings).done(function (response) {
           if(response[0] == null){
               var mesgBox = document.getElementsByClassName('messageBox')[0];
               mesgBox.style.display = "block"
           } else {
               for(var j =0; j<=response.length-1; j++){
                   idArray.push(response[j].id)
               }
               var highestId = Math.max(...idArray)
               var lowestId = highestId-12
               for(var i=0; i<=response.length-1; i++){
                   if(lowestId<response[i].id && response[i].id<=highestId){
                       xValues.push(response[i].captured_date);
                       yValues.push(response[i].roi);
                   }
               }
               creatngChart(xValues, yValues)
               creatingTable(response);
           }
        }).fail(function() {
                alert( "Request Failed!" );
            });
     }
     function creatingTable(resp) {
        var tableData = resp
        var table = new Tabulator("#chartTable", {
            data: tableData,
            autoColumns:true,
        });
      }
</script>
</html>
























